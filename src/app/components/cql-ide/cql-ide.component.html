<div class="ide-container">
  <!-- Main Layout -->
  <div class="ide-layout">
    <!-- Left Panel -->
    <app-ide-panel
      *ngIf="ideStateService.getPanel('left')?.isVisible"
      [panel]="ideStateService.getPanel('left')!"
      [position]="'left'"
      (togglePanel)="onTogglePanel('left')"
      (setActiveTab)="onSetActiveTab('left', $event)"
      (startResize)="onStartResize($event)"
      (moveTab)="onMoveTab($event)"
      (tabDrop)="onTabDrop($event)"
      (dragOver)="onDragOver($event)"
      (dragLeave)="onDragLeave($event)"
      (executeAll)="onExecuteAll()">
    </app-ide-panel>

    <!-- Main Content Area -->
    <div class="main-content">
      <!-- Editor Tabs -->
      <app-editor-tabs
        (selectLibrary)="onLibraryIdChange($event)"
        (closeLibrary)="onDeleteLibrary($event)"
        (reorderTabs)="onReorderEditorTabs($event)">
      </app-editor-tabs>

      <!-- CQL Editor -->
      <div class="editor-area">
        <app-cql-editor
          *ngIf="ideStateService.activeLibraryId()"
          [editorState]="ideStateService.editorState()"
          [content]="getActiveLibraryContent()"
          [placeholder]="'Start writing CQL...'"
          [height]="'100%'"
          [readonly]="false"
          [cqlVersion]="'1.5.3'"
          (contentChange)="onEditorContentChange($event)"
          (syntaxErrors)="onEditorSyntaxErrors($event)"
          (executeLibrary)="onExecuteLibrary()"
          (reloadLibrary)="onReloadLibrary()"
          (cqlVersionChange)="onCqlVersionChange($event)"
          (formatCql)="onFormatCql()"
          (validateCql)="onValidateCql()"
          (saveLibrary)="onSaveLibrary()">
        </app-cql-editor>
        <div *ngIf="!ideStateService.activeLibraryId()" class="welcome-message">
          <h2>Welcome to the CQL IDE</h2>
          <p>Open or create a new CQL library to start editing.</p>
        </div>
      </div>
    </div>

    <!-- Right Panel -->
    <app-ide-panel
      *ngIf="ideStateService.getPanel('right')?.isVisible"
      [panel]="ideStateService.getPanel('right')!"
      [position]="'right'"
      (togglePanel)="onTogglePanel('right')"
      (setActiveTab)="onSetActiveTab('right', $event)"
      (startResize)="onStartResize($event)"
      (moveTab)="onMoveTab($event)"
      (tabDrop)="onTabDrop($event)"
      (dragOver)="onDragOver($event)"
      (dragLeave)="onDragLeave($event)"
      (executeAll)="onExecuteAll()">
    </app-ide-panel>
  </div>

  <!-- Bottom Panel -->
  <app-ide-panel
    *ngIf="ideStateService.getPanel('bottom')?.isVisible"
    [panel]="ideStateService.getPanel('bottom')!"
    [position]="'bottom'"
    (togglePanel)="onTogglePanel('bottom')"
    (setActiveTab)="onSetActiveTab('bottom', $event)"
    (startResize)="onStartResize($event)"
    (moveTab)="onMoveTab($event)"
    (tabDrop)="onTabDrop($event)"
    (dragOver)="onDragOver($event)"
    (dragLeave)="onDragLeave($event)"
    (executeAll)="onExecuteAll()">
  </app-ide-panel>

  <!-- Status Bar -->
  <app-ide-status-bar
    [editorState]="ideStateService.editorState()"
    [executionProgress]="ideStateService.executionProgress()"
    [executionStatus]="ideStateService.executionStatus()"
    [cqlVersion]="'1.5.3'"
    [selectedPatientsCount]="selectedPatients.length"
    [isLoadingLibraries]="false">
  </app-ide-status-bar>
</div>