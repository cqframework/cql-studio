<div class="console-panel d-flex flex-column bg-dark text-light">
  <div class="d-flex align-items-center gap-2 px-2 border-bottom ">
    <button class="btn  btn-sm" (click)="onClearOutput()" title="Clear Console">
      <i class="bi-trash me-1"></i> Clear
    </button>
    <button class="btn  btn-sm" (click)="onCopyOutput()" title="Copy Console">
      <i class="bi-copy me-1"></i> Copy
    </button>
    <button class="btn btn-sm" (click)="onToggleAllSections()" title="Toggle All Sections">
      <i class="bi-{{ allSectionsExpanded ? 'collapse' : 'expand' }} me-1"></i>
      {{ allSectionsExpanded ? 'Collapse All' : 'Expand All' }}
    </button>
    <div class="form-check ms-auto d-flex align-items-center gap-2">
      <input class="form-check-input" type="checkbox" id="preserveLogs" [ngModel]="preserveLogs"
        (ngModelChange)="onPreserveLogsChange($event)" title="Preserve logs between executions">
      <label class="form-check-label small text-light mb-0" for="preserveLogs">
        Preserve Logs
      </label>
    </div>
  </div>
  <div class="flex-fill overflow-auto" [class.executing]="isEvaluating">
    <div class="p-2">
      <div *ngFor="let section of outputSections(); let i = index" class="border rounded mb-2 "
        [class.expanded]="section.expanded">
        <div class="d-flex align-items-center gap-2 p-2 border-bottom " (click)="onToggleSection(i)">
          <i class="bi-{{ section.expanded ? 'chevron-down' : 'chevron-right' }}"></i>
          <span class="fw-medium flex-fill text-white">{{ section.title }}</span>
          <span class="badge" [class.bg-success]="section.status === 'success'"
            [class.bg-danger]="section.status === 'error'"
            [class.bg-warning]="section.status !== 'success' && section.status !== 'error'">
            {{ section.status === 'success' ? 'SUCCESS' : section.status === 'error' ? 'ERROR' : 'PENDING' }}
          </span>
          <span class="small text-muted" *ngIf="section.executionTime">{{ section.executionTime }}ms</span>
        </div>
        <div class="p-3 bg-dark" *ngIf="section.expanded">
          <app-syntax-highlighter [code]="section.content" [language]="'json'"></app-syntax-highlighter>
        </div>
      </div>
    </div>
    <div *ngIf="outputSections().length === 0 && !isEvaluating"
      class="no-console d-flex flex-column align-items-center justify-content-center py-4 text-muted">
      <span>No console output yet. Click "Execute All" to run open libraries.</span>
    </div>
    <div *ngIf="isEvaluating" class="p-3 border-top bg-secondary">
      <div class="progress mb-2">
        <div class="progress-bar" [style.width.%]="executionProgress"></div>
      </div>
      <span class="small text-light">{{ executionStatus }}</span>
    </div>
  </div>
</div>
